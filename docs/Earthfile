VERSION 0.7

# cspell: words runable

# Copy all the source we need to build the docs
src:
    FROM ../earthly/docs+mkdocs-material

    # Just copy the actual doc src here.
    COPY --dir src includes macros overrides mkdocs.yml /docs

    # Now copy into that any artifacts we pull from the builds.
    COPY --dir ../+repo-docs/repo /docs/includes


# Build the docs here.
docs:
    FROM +src

    DO ../earthly/docs+BUILD

    RUN /scripts/build.sh

    SAVE ARTIFACT /site/*

# Make a locally runable container that can serve the docs.
local:
    # Build a self contained service to show built docs locally.
    DO ../earthly/docs+PACKAGE

    # Copy the static pages into the container
    COPY +docs/ /usr/share/nginx/html

    # This is a local only image, we do not publish it.
    SAVE IMAGE cat-ci-docs:latest