# Common Python UDCs and Builders.
VERSION --global-cache --use-function-keyword 0.7

# Assuming the detailed setup from the second snippet is defined in relevant Earthly targets.

builder:
    DO ./../../earthly/python+BUILDER

    # Copy the src directory and project-specific files into /poetry in the container.
    # Adjusted to match your setup where the WORKDIR is set to /poetry.
    COPY --dir src ./src
    COPY pyproject.toml poetry.lock ./

    # Install dependencies without creating a virtual environment inside the container.
    RUN poetry install --no-root

    # Lint the application using ruff.
    RUN ruff ./src

check:
    FROM +builder

    DO ./../../earthly/python+CHECK

python-linter:
    FROM +builder
    
    DO ./../../earthly/python+LINT_PYTHON