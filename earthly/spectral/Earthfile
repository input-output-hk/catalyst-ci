VERSION --global-cache 0.7 

# cspell: words ruleset

BUILD_SPECTRAL:
    COMMAND

    # Specify what file type to lint 
    ARG FILE_TYPE = "json"
    ARG DIR = .
    ARG src = .
    # Rule set for spectral
    ARG rule_set=.spectral.yml

    FROM stoplight/spectral
    WORKDIR /work
    COPY $src .
    
    # Make the command executable
    RUN chmod +x ./earthly/spectral/minify-json.sh

    # If file type is json, minify the JSON
    RUN ./earthly/spectral/minify-json.sh

    RUN spectral \
        lint \
        $DIR/"**/*.{yml,json}" \
        --ruleset $rule_set