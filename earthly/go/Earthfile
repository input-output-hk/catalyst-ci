VERSION 0.7

FMT:
    COMMAND

    FROM cytopia/gofmt:latest
    WORKDIR /work

    ARG --required src

    FOR f IN ${src}
        COPY ${f} /work/${f}
    END

    RUN gofmt -l . | grep . && exit 1 || exit 0

LINT:
    COMMAND

    FROM golangci/golangci-lint:latest
    WORKDIR /work

    ARG --required src

    FOR f IN ${src}
        COPY ${f} /work/${f}
    END

    CACHE --sharing shared /cache
    ENV GOLANGCI_LINT_CACHE=/cache/golangci-lint
    ENV GOCACHE=/cache/go-build

    RUN golangci-lint run \
        --timeout 5m \
        -E errchkjson \
        -E ginkgolinter \
        -E godot \
        -E goimports \
        -E gosec \
        -E nilnil \
        -E revive \
        -E testpackage