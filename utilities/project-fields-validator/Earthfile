VERSION 0.8

IMPORT github.com/input-output-hk/catalyst-ci/earthly/python:v3.1.7 AS python-ci

test:
    FROM python-ci+python-base

    COPY . .

    DO python-ci+CHECK

validate-pr:
    FROM python-ci+python-base

    COPY . .

    RUN pip install requests

    # Set environment variables
    ENV ORG_NAME=input-output-hk
    ENV PROJECT_NUMBER=102
    ARG PR_NUMBER
    ARG GITHUB_TOKEN

    RUN --secret GITHUB_TOKEN python3 main.py

    # Check the validation results
    RUN if [ -f ".github/project_validation_results.txt" ]; then \
            echo "Validation failed. See results:" && \
            cat .github/project_validation_results.txt && \
            exit 1; \
        fi